import{d as V,r as m,o as Y,a as w,b as ne,c as l,e as r,f as e,g as o,w as le,h,i as f,j as S,k as N,t as g,l as M,F as G,E as J,_ as O,u as H,m as X,n as oe,p as L,q as ee,s as A,v as B,x as se,y as F,z as K,A as ae}from"./index-DvE8zddU.js";import{h as C}from"./axios-Dzwg4HKv.js";/* empty css                                                                       */import{_ as ie}from"./HomeView.vue_vue_type_script_setup_true_lang-BorIiMJn.js";const re={style:{padding:"10px 10px"}},ce={alt:"avatar"},de={key:0},ue={key:1},_e=e("br",null,null,-1),pe={key:2,style:{color:"#909399","font-size":"12px"}},he=V({__name:"ContactsList",emits:["wxid"],setup(t,{emit:i}){const n=m([]),a=async()=>{try{return await C.post("/api/recent_user_list",{})}catch(u){return console.error("Error fetching data:",u),[]}},s=async(u="")=>{try{return await C.post("/api/user_list",{word:u})}catch($){return console.error("Error fetching data:",$),[]}};Y(async()=>{try{n.value=await a()}catch(u){return console.error("Error fetching data:",u),[]}});const v=m(""),p=async()=>{try{if(v.value===""){n.value=await a();return}n.value=await s(v.value)}catch(u){return console.error("Error fetching data:",u),[]}},d=i,b=u=>{u!==void 0&&d("wxid",u.wxid)};return(u,$)=>{const T=w("el-input"),x=w("el-button"),D=w("el-avatar"),I=w("el-table-column"),j=w("el-table"),R=ne("lazy");return l(),r("div",null,[e("div",re,[o(T,{placeholder:"请输入关键字",modelValue:v.value,"onUpdate:modelValue":$[0]||($[0]=y=>v.value=y),onKeyup:le(p,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),o(x,{type:"primary",onClick:p,style:{width:"50px"}},{default:h(()=>[f("搜索")]),_:1})]),o(j,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:b},{default:h(()=>[o(I,{width:"57"},{default:h(({row:y})=>[y.headImgUrl!==""?(l(),S(D,{key:0,size:33},{default:h(()=>[N(e("img",ce,null,512),[[R,"/api/imgsrc/"+y.headImgUrl]])]),_:2},1024)):(l(),S(D,{key:1,size:33},{default:h(()=>[f(" 群聊 ")]),_:1}))]),_:1}),o(I,{width:"190"},{default:h(({row:y})=>[y.remark!==null&&y.remark!==""?(l(),r("span",de,g(y.remark),1)):(l(),r("span",ue,g(y.nickname),1)),_e,y.LastReadedCreateTime!==void 0&&y.LastReadedCreateTime!==null?(l(),r("span",pe,g(y.LastReadedCreateTime),1)):M("",!0)]),_:1})]),_:1},8,["data"])])}}}),ve=V({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},emits:["exporting"],setup(t,{emit:i}){const n=m(!1),a=async()=>{if(n.value){console.log("正在获取实时消息，请稍后再试!");return}n.value=!0;try{const d=await C.post("/api/realtimemsg",{});return n.value=!1,J({title:"Success",message:"获取实时消息成功!",type:"success"}),d}catch(d){return n.value=!1,J({title:"Error",message:"获取实时消息失败!",type:"error"}),console.error("Error fetching data:",d),[]}},s=m(!1),c=i,v=()=>{c("exporting",!0),s.value=!0},p=()=>{c("exporting",!1),s.value=!1};return(d,b)=>{const u=w("el-text"),$=w("el-col"),T=w("el-row");return l(),r(G,null,[o(T,{gutter:5,style:{width:"100%"}},{default:h(()=>[o($,{span:6,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"label_color mx-1",truncated:""},{default:h(()=>[f("wxid:")]),_:1}),f("  "),o(u,{class:"data_color mx-1",truncated:"",title:t.userData.wxid},{default:h(()=>[f(g(t.userData.wxid),1)]),_:1},8,["title"])]),_:1}),o($,{span:6,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"label_color mx-1",truncated:""},{default:h(()=>[f("账号:")]),_:1}),f("  "),o(u,{class:"data_color mx-1",truncated:"",title:t.userData.account},{default:h(()=>[f(g(t.userData.account),1)]),_:1},8,["title"])]),_:1}),o($,{span:6,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"label_color mx-1",truncated:""},{default:h(()=>[f("昵称:")]),_:1}),f("  "),o(u,{class:"data_color mx-1",truncated:"",title:t.userData.nickname},{default:h(()=>[f(g(t.userData.nickname),1)]),_:1},8,["title"])]),_:1}),o($,{span:6,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"label_color mx-1",truncated:""},{default:h(()=>[f("备注:")]),_:1}),f("  "),o(u,{class:"data_color mx-1",truncated:"",title:t.userData.remark},{default:h(()=>[f(g(t.userData.remark),1)]),_:1},8,["title"])]),_:1})]),_:1}),o(T,{gutter:5,style:{width:"100%"}},{default:h(()=>[o($,{span:3,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"label_color mx-1",truncated:""},{default:h(()=>[f("数量:")]),_:1}),f("  "),o(u,{class:"data_color mx-1",truncated:"",title:t.userData.msg_count},{default:h(()=>[f(g(t.userData.msg_count),1)]),_:1},8,["title"])]),_:1}),o($,{span:15,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"label_color mx-1",truncated:""},{default:h(()=>[f("描述:")]),_:1}),f("  "),o(u,{class:"data_color mx-1",truncated:"",title:t.userData.describe},{default:h(()=>[f(g(t.userData.describe),1)]),_:1},8,["title"])]),_:1}),o($,{span:3,style:{"white-space":"nowrap"}},{default:h(()=>[o(u,{class:"button_color mx-1 underline",truncated:"",onClick:b[0]||(b[0]=x=>{a()})},{default:h(()=>[f("实时消息 "),n.value?(l(),r(G,{key:0},[f("(获取中)")],64)):M("",!0)]),_:1})]),_:1}),o($,{span:3,style:{"white-space":"nowrap"}},{default:h(()=>[s.value?M("",!0):(l(),S(u,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:b[1]||(b[1]=x=>{v()})},{default:h(()=>[f("导出备份")]),_:1})),s.value?(l(),S(u,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:b[2]||(b[2]=x=>{p()})},{default:h(()=>[f("聊天查看")]),_:1})):M("",!0)]),_:1})]),_:1})],64)}}}),fe=O(ve,[["__scopeId","data-v-0ff14340"]]),me={class:"chat-content"},ye={key:0,class:"word"},xe=["src"],we={class:"info"},ge={class:"time"},be=["innerHTML"],$e={key:1,class:"word-my"},ke={class:"info"},Ue={class:"time"},Se=["innerHTML"],Ve=["src"],Me=V({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const i=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,a)=>(l(),r("div",me,[t.is_sender?(l(),r("div",$e,[e("div",ke,[e("p",Ue,g(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,Se)]),e("img",{src:t.headUrl},null,8,Ve)])):(l(),r("div",ye,[e("img",{src:t.headUrl},null,8,xe),e("div",we,[e("p",ge,g(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,be)])]))]))}}),Q=O(Me,[["__scopeId","data-v-d930be9e"]]),Ee={class:"chat-content"},Ce={key:0,class:"word"},Te=["src"],De={class:"info"},qe={class:"time"},ze={class:"demo-image__preview"},Re={key:1,class:"word-my"},je={class:"info"},Ie={class:"time"},Le={class:"demo-image__preview"},Oe=["src"],He=V({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(i,n)=>{const a=w("el-image");return l(),r("div",Ee,[t.is_sender?(l(),r("div",Re,[e("div",je,[e("p",Ie,g(t.direction),1),e("div",Le,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Oe)])):(l(),r("div",Ce,[e("img",{src:t.headUrl},null,8,Te),e("div",De,[e("p",qe,g(t.direction),1),e("div",ze,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Ne=O(He,[["__scopeId","data-v-24d6aaa0"]]),Be={class:"chat-content"},Fe={key:0,class:"word"},Ae=["src"],Pe={class:"info"},We={class:"time"},Ke={class:"demo-video__preview"},Ge={controls:"",width:"30%"},Ye=["src"],Je={key:1,class:"word-my"},Xe={class:"info"},Qe={class:"time"},Ze={class:"demo-video__preview"},et={controls:"",width:"50%"},tt=["src"],nt=["src"],lt=V({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(i,n)=>(l(),r("div",Be,[t.is_sender?(l(),r("div",Je,[e("div",Xe,[e("p",Qe,g(t.direction),1),e("div",Ze,[e("video",et,[e("source",{src:t.src,type:"video/mp4"},null,8,tt)])])]),e("img",{src:t.headUrl},null,8,nt)])):(l(),r("div",Fe,[e("img",{src:t.headUrl},null,8,Ae),e("div",Pe,[e("p",We,g(t.direction),1),e("div",Ke,[e("video",Ge,[e("source",{src:t.src,type:"video/mp4"},null,8,Ye)])])])]))]))}}),ot=O(lt,[["__scopeId","data-v-5aa79515"]]),st={class:"chat-content"},at={key:0,class:"word"},it=["src"],rt={class:"info"},ct={class:"time"},dt={controls:"",style:{"background-color":"#fff"}},ut=["src"],_t={key:1,class:"word-my"},pt={class:"info"},ht={class:"time"},vt={controls:"",style:{"background-color":"#95EC69"}},ft=["src"],mt=["src"],yt=V({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(i,n)=>(l(),r("div",st,[t.is_sender?(l(),r("div",_t,[e("div",pt,[e("p",ht,g(t.direction),1),e("audio",vt,[e("source",{src:t.src,type:"audio/wav"},null,8,ft)]),o(H(X),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,mt)])):(l(),r("div",at,[e("img",{src:t.headUrl},null,8,it),e("div",rt,[e("p",ct,g(t.direction),1),e("audio",dt,[e("source",{src:t.src,type:"audio/wav"},null,8,ut)]),o(H(X),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),xt=O(yt,[["__scopeId","data-v-0d0f2cd4"]]),wt={class:"chat-content"},gt={key:0,class:"word"},bt=["src"],$t={class:"info"},kt={class:"time"},Ut={style:{float:"left"}},St=["href"],Vt={key:1,class:"word-my"},Mt={class:"info"},Et={class:"time"},Ct={style:{float:"right"}},Tt=["href"],Dt=["src"],qt=V({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const i=t,n=m(""),a=oe({file_name:String,file_size:Number,file_size_unit:String});Y(async()=>{console.log("文件加载中");const c=await s(i.src);a.file_name=c.file_name,a.file_size=Number(c.file_size)/1024,a.file_size<1024?a.file_size_unit="kb":(a.file_size=a.file_size/1024,a.file_size_unit="mb"),a.file_size=Number(c.file_size)/1024,n.value=`/api/file/${i.src}`});const s=async c=>{try{return await C.post("/api/file_info",{file_path:c})}catch(v){return console.error("Error fetching file_info:",v),""}};return(c,v)=>{const p=w("el-card");return l(),r("div",wt,[t.is_sender?(l(),r("div",Vt,[e("div",Mt,[e("p",Et,g(t.direction),1),e("div",Ct,[o(p,{shadow:"hover",style:{width:"fit-content"}},{default:h(()=>[f("文件 ： "),e("a",{href:n.value,download:""},g(a.file_name),9,Tt),e("div",null,[f(" 文件大小："),e("span",null,g(a.file_size)+g(a.file_size_unit),1)])]),_:1})])]),e("img",{src:t.headUrl},null,8,Dt)])):(l(),r("div",gt,[e("img",{src:t.headUrl},null,8,bt),e("div",$t,[e("p",kt,g(t.direction),1),e("div",Ut,[o(p,{shadow:"hover",style:{width:"fit-content"}},{default:h(()=>[f("文件 ： "),e("a",{href:n.value,download:""},g(a.file_name),9,St),e("div",null,[f(" 文件大小："),e("span",null,g(a.file_size)+g(a.file_size_unit),1)])]),_:1})])])]))])}}}),zt=O(qt,[["__scopeId","data-v-e797f204"]]),Rt={class:"chat-content"},jt={key:0,class:"word"},It=["src"],Lt={class:"info"},Ot={class:"time"},Ht={class:"demo-image__preview"},Nt={key:1,class:"word-my"},Bt={class:"info"},Ft={class:"time"},At={class:"demo-image__preview"},Pt=["src"],Wt=V({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(i,n)=>{const a=w("el-image");return l(),r("div",Rt,[t.is_sender?(l(),r("div",Nt,[e("div",Bt,[e("p",Ft,g(t.direction),1),e("div",At,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Pt)])):(l(),r("div",jt,[e("img",{src:t.headUrl},null,8,It),e("div",Lt,[e("p",Ot,g(t.direction),1),e("div",Ht,[o(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Kt=O(Wt,[["__scopeId","data-v-ad34c109"]]),Gt={class:"chat-content"},Yt={key:0,class:"word"},Jt=["src"],Xt={class:"info"},Qt={class:"time"},Zt=["innerHTML"],en={key:1,class:"word-my"},tn={class:"info"},nn={class:"time"},ln=["innerHTML"],on=["src"],sn=V({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const i=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,a)=>(l(),r("div",Gt,[t.is_sender?(l(),r("div",en,[e("div",tn,[e("p",nn,g(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,ln)]),e("img",{src:t.headUrl},null,8,on)])):(l(),r("div",Yt,[e("img",{src:t.headUrl},null,8,Jt),e("div",Xt,[e("p",Qt,g(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,Zt)])]))]))}}),an=O(sn,[["__scopeId","data-v-e529325a"]]),rn={class:"chat-content"},cn={key:0,class:"word"},dn=["src"],un={class:"time"},_n=["href"],pn={class:"content"},hn={class:"source-info"},vn={key:1,class:"word-my"},fn={class:"time"},mn=["href"],yn={class:"content"},xn={class:"source-info"},wn=["src"],gn=V({__name:"CardLikeLink",props:{is_sender:{type:Number,default:0},content:{type:Object,default:()=>({})},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){return(i,n)=>(l(),r("div",rn,[t.is_sender?(l(),r("div",vn,[e("div",null,[e("p",fn,g(t.direction),1),e("a",{class:"card",href:t.content.src,target:"_blank"},[e("div",yn,[e("h2",null,[e("b",null,g(t.content.title),1)]),e("div",null,g(t.content.des),1)]),e("div",xn,g(t.content.sourcedisplayname),1)],8,mn)]),e("img",{src:t.headUrl},null,8,wn)])):(l(),r("div",cn,[e("img",{src:t.headUrl},null,8,dn),e("div",null,[e("p",un,g(t.direction),1),e("a",{class:"card",href:t.content.src,target:"_blank"},[e("div",pn,[e("h2",null,[e("b",null,g(t.content.title),1)]),e("div",null,g(t.content.des),1)]),e("div",hn,g(t.content.sourcedisplayname),1)],8,_n)])]))]))}}),bn=O(gn,[["__scopeId","data-v-472f4c3b"]]),$n={id:"chat"},kn={class:"chat_body"},Un={class:"chat_window",ref:"chatWindow"},Sn={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},Vn=V({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(t,{expose:i}){const n=t,a=m([]),s=m({}),c=m(!1),v=m(""),p=m(0),d=m(100),b=m(0),u=m(!1),$=async(y,q,E)=>{if(c.value){console.log("正在获取消息，请稍后再试!");return}if(E==""){console.log("wxid 为空, 请检查!");return}try{c.value=!0,y<0&&(y=0);const _=await C.post("/api/msgs",{start:y,limit:q,wxid:E});return a.value=_.msg_list,s.value=Object.assign(s.value,_.user_list),c.value=!1,_}catch(_){return c.value=!1,console.error("Error fetching data:",_),[]}},T=async y=>{try{return(await C.post("/api/msg_count",{wxid:y}))[y]}catch(q){return console.error("Error fetching data msg_count:",q),[]}},x=async()=>{try{return(await C.get("/api/mywxid")).my_wxid}catch(y){return console.error("Error fetching data my_wxid:",y),[]}},D=async()=>{try{v.value=await x(),b.value=await T(n.userData.wxid),p.value=b.value-d.value,p.value<0&&(p.value=0),await $(p.value,d.value,n.userData.wxid),u.value||await A(()=>{n.setScrollTop(),u.value=!1})}catch(y){return console.error("Error fetching data:",y),[]}};L(()=>n.userData.wxid,(y,q)=>{console.log("username changed： ",q,y),a.value=[],s.value={},u.value=!1,b.value=0,p.value=0,D()});const I=async()=>{v.value=await x(),b.value=await T(n.userData.wxid);let y=d.value,q=p.value-y;q<0&&(q=0);const E=await $(q,y,n.userData.wxid);p.value=q,console.log("loadMore",q,p.value,y,n.userData.wxid),E&&(a.value=E.msg_list.concat(a.value)),a.value.sort((_,U)=>_.id-U.id),a.value=a.value.filter((_,U,k)=>U===0||_.id!==k[U-1].id),s.value=Object.assign(s.value,E.user_list),await A(()=>{n.updateScrollTop()})};i({loadMore:I});const j=y=>(y.talker=="我"&&(y.talker=v.value),`${(E=>s.value.hasOwnProperty(E.talker)?s.value[E.talker].remark?s.value[E.talker].remark:s.value[E.talker].nickname?s.value[E.talker].nickname:s.value[E.talker].account?s.value[E.talker].account:E.talker:E.talker)(y)} [${y.type_name}] ${y.CreateTime}`),R=y=>(y.talker=="我"&&(y.talker=v.value),s.value.hasOwnProperty(y.talker)?"/api/imgsrc/"+s.value[y.talker].headImgUrl:"");return(y,q)=>{const E=w("el-button");return l(),r("div",$n,[e("div",kn,[e("div",Un,[a.value.length<b.value?(l(),r("div",Sn,[o(E,{type:"primary",onClick:I},{default:h(()=>[f("查看更多消息")]),_:1})])):M("",!0),(l(!0),r(G,null,ee(a.value,(_,U)=>(l(),r("div",{class:"message",key:U},[_.type_name=="文本"?(l(),S(Q,{key:0,is_sender:_.is_sender,direction:j(_),headUrl:R(_),content:_.content.msg},null,8,["is_sender","direction","headUrl","content"])):_.type_name=="图片"?(l(),S(Ne,{key:1,is_sender:_.is_sender,direction:j(_),headUrl:R(_),src:"/api/img/"+_.content.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="动画表情"?(l(),S(Kt,{key:2,is_sender:_.is_sender,direction:j(_),headUrl:R(_),src:"/api/imgsrc/"+_.content.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="视频"?(l(),S(ot,{key:3,is_sender:_.is_sender,direction:j(_),headUrl:R(_),src:"/api/video/"+_.content.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="文件"?(l(),S(zt,{key:4,is_sender:_.is_sender,direction:j(_),headUrl:R(_),src:_.content.src},null,8,["is_sender","direction","headUrl","src"])):_.type_name=="语音"?(l(),S(xt,{key:5,is_sender:_.is_sender,direction:j(_),headUrl:R(_),src:"/api/"+_.content.src,msg:_.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):_.type_name=="卡片式链接"?(l(),S(bn,{key:6,is_sender:_.is_sender,direction:j(_),headUrl:R(_),content:_.content},null,8,["is_sender","direction","headUrl","content"])):_.type_name=="推荐公众号"?(l(),S(Q,{key:7,is_sender:_.is_sender,direction:j(_),headUrl:R(_),content:_.content.nickname},null,8,["is_sender","direction","headUrl","content"])):(l(),S(an,{key:8,is_sender:_.is_sender,direction:j(_),headUrl:R(_),content:_.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),Mn=O(Vn,[["__scopeId","data-v-9809be2d"]]),En=e("br",null,null,-1),Cn=e("br",null,null,-1),Tn={style:{position:"relative"}},Dn=V({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(c,v)=>{console.log(c)});const n=m(""),a=m(""),s=async()=>{a.value="请求中...";try{a.value=await C.post("/api/export_endb",{wx_path:n.value})}catch(c){return console.error("Error fetching data msg_count:",c),a.value=`请求失败
`+c,[]}};return(c,v)=>{const p=w("el-input"),d=w("el-button"),b=w("el-divider");return l(),r("div",null,[f(" 微信文件夹路径(可选)： "),o(p,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=u=>n.value=u),style:{width:"70%"}},null,8,["modelValue"]),En,Cn,e("div",Tn,[o(d,{type:"primary",onClick:v[1]||(v[1]=u=>s())},{default:h(()=>[f("导出")]),_:1})]),o(b),o(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:a.value,"onUpdate:modelValue":v[2]||(v[2]=u=>a.value=u),style:{width:"100%"}},null,8,["modelValue"])])}}}),qn=e("br",null,null,-1),zn=e("br",null,null,-1),Rn=e("br",null,null,-1),jn=e("br",null,null,-1),In={style:{position:"relative"}},Ln=V({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(v,p)=>{console.log(v)});const n=m(""),a=m(""),s=m(""),c=async()=>{s.value="正在处理中...";try{s.value=await C.post("/api/export_dedb",{key:a.value,wx_path:n.value})}catch(v){return console.error("Error fetching data msg_count:",v),s.value=`请求失败
`+v,[]}};return(v,p)=>{const d=w("el-input"),b=w("el-button"),u=w("el-divider");return l(),r("div",null,[f(" 密钥(可选)： "),o(d,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=$=>a.value=$),style:{width:"75%"}},null,8,["modelValue"]),qn,zn,f(" 微信文件夹路径(可选)： "),o(d,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":p[1]||(p[1]=$=>n.value=$),style:{width:"70%"}},null,8,["modelValue"]),Rn,jn,e("div",In,[o(b,{type:"primary",onClick:p[2]||(p[2]=$=>c())},{default:h(()=>[f("导出")]),_:1})]),o(u),o(d,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:s.value,"onUpdate:modelValue":p[3]||(p[3]=$=>s.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),On={style:{position:"relative"}},Hn=V({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(s,c)=>{console.log(s)});const n=m(""),a=async()=>{n.value="正在处理中...";try{n.value=await C.post("/api/export_csv",{wxid:i.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),n.value=`请求失败
`+s,[]}};return(s,c)=>{const v=w("el-button"),p=w("el-divider"),d=w("el-input");return l(),r("div",null,[e("div",On,[o(v,{type:"primary",onClick:c[0]||(c[0]=b=>a())},{default:h(()=>[f("导出")]),_:1})]),o(p),o(d,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=b=>n.value=b),style:{width:"100%"}},null,8,["modelValue"])])}}}),Nn={style:{position:"relative"}},Bn=V({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(s,c)=>{console.log(s)}),m([]);const n=m(""),a=async()=>{n.value="正在处理中...";try{n.value=await C.post("/api/export_json",{wxid:i.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),n.value=`请求失败
`+s,[]}};return(s,c)=>{const v=w("el-button"),p=w("el-divider"),d=w("el-input");return l(),r("div",null,[e("div",Nn,[o(v,{type:"primary",onClick:c[0]||(c[0]=b=>a())},{default:h(()=>[f("导出")]),_:1})]),o(p),o(d,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=b=>n.value=b),style:{width:"100%"}},null,8,["modelValue"])])}}}),Fn={style:{position:"relative"}},An=V({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(s,c)=>{console.log(s)}),m([]);const n=m(""),a=async()=>{n.value="正在处理中...";try{n.value=await C.post("/api/export_html",{wxid:i.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),n.value=`请求失败
`+s,[]}};return(s,c)=>{const v=w("el-button"),p=w("el-divider"),d=w("el-input");return l(),r("div",null,[e("div",Fn,[o(v,{type:"primary",onClick:c[0]||(c[0]=b=>a())},{default:h(()=>[f("导出")]),_:1})]),o(p),o(d,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=b=>n.value=b),style:{width:"100%"}},null,8,["modelValue"])])}}}),Pn=e("br",null,null,-1),Wn=V({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(a,s)=>{console.log(a)});const n=()=>{console.log("requestExport")};return(a,s)=>{const c=w("el-button");return l(),r("div",null,[e("span",null,g(i.wxid),1),Pn,o(c,{type:"primary",onClick:s[0]||(s[0]=v=>n())},{default:h(()=>[f("导出")]),_:1})])}}}),Kn=e("br",null,null,-1),Gn=V({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(a,s)=>{console.log(a)});const n=()=>{console.log("requestExport")};return(a,s)=>{const c=w("el-button");return l(),r("div",null,[e("span",null,g(i.wxid),1),Kn,o(c,{type:"primary",onClick:s[0]||(s[0]=v=>n())},{default:h(()=>[f("导出")]),_:1})])}}}),Yn={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Jn={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Xn={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Qn=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Zn={style:{"margin-top":"20px"}},el=e("br",null,null,-1),tl=e("br",null,null,-1),nl={key:0},ll=V({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(t){const i=t;L(()=>i.wxid,(s,c)=>{console.log(s)});const n=m("");m("");const a={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(s,c)=>{const v=w("el-option"),p=w("el-select"),d=w("el-divider"),b=w("el-main");return l(),r("div",Yn,[o(b,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:h(()=>[e("div",Jn,[e("div",Xn,[Qn,e("div",Zn,[f(" 导出类型: "),o(p,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=u=>n.value=u)},{default:h(()=>[(l(),r(G,null,ee(a,(u,$)=>o(v,{label:u.brief,value:$,key:$},{default:h(()=>[f(g(u.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),el,tl,n.value?(l(),r("span",nl,g(a[n.value].detail),1)):M("",!0)]),o(d),n.value=="endb"?(l(),S(Dn,{key:0,wxid:i.wxid},null,8,["wxid"])):M("",!0),n.value=="dedb"?(l(),S(Ln,{key:1,wxid:i.wxid},null,8,["wxid"])):M("",!0),n.value=="csv"?(l(),S(Hn,{key:2,wxid:i.wxid},null,8,["wxid"])):M("",!0),n.value=="json"?(l(),S(Bn,{key:3,wxid:i.wxid},null,8,["wxid"])):M("",!0),n.value=="html"?(l(),S(An,{key:4,wxid:i.wxid},null,8,["wxid"])):M("",!0),n.value=="pdf"?(l(),S(Wn,{key:5,wxid:i.wxid},null,8,["wxid"])):M("",!0),n.value=="docx"?(l(),S(Gn,{key:6,wxid:i.wxid},null,8,["wxid"])):M("",!0)])])]),_:1})])}}}),ol=V({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(t){const i=m(null),n=m(null);m(0);const a=m(0),s=()=>{A(()=>{if(i.value){const x=i.value.$el.children[0];x&&(x.scrollTop=x.scrollHeight,a.value=x.scrollHeight)}})},c=()=>{const x=i.value.$el.children[0];if(x){const D=a.value,I=x.scrollHeight-D;x.scrollTop=x.scrollTop+I,a.value=x.scrollHeight}};function v({scrollTop:x}){x===0&&n.value&&n.value.loadMore()}const p=t,d=m({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",wxid:"",msg_count:0}),b=async()=>{try{const x=await C.post("/api/wxid2user",{wxid:p.wxid});return d.value.account=x[p.wxid].account,d.value.describe=x[p.wxid].describe,d.value.headImgUrl=x[p.wxid].headImgUrl,d.value.nickname=x[p.wxid].nickname,d.value.remark=x[p.wxid].remark,d.value.wxid=p.wxid,x}catch(x){return console.error("Error fetching data wxid2user :",x),[]}},u=async()=>{try{const x=await C.post("/api/msg_count",{wxid:p.wxid});return d.value.msg_count=x[p.wxid],x}catch(x){return console.error("Error fetching data msg_count:",x),[]}};Y(()=>{u(),b(),A(()=>{s()})});const $=m(!1),T=x=>{$.value=x,$.value===!1&&(d.value.wxid="",b())};return L(()=>p.wxid,async(x,D)=>{x!==D&&(b(),u(),$.value=!1,A(()=>{s()}))}),(x,D)=>{const I=w("el-header"),j=w("el-scrollbar"),R=w("el-main"),y=w("el-container");return l(),S(y,null,{default:h(()=>[o(I,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:h(()=>[o(fe,{userData:d.value,onExporting:T},null,8,["userData"])]),_:1}),o(R,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",width:"100%",padding:"0"}},{default:h(()=>[o(j,{ref_key:"scrollbarRef",ref:i,onScroll:v},{default:h(()=>[$.value?(l(),S(ll,{key:0,wxid:d.value.wxid},null,8,["wxid"])):(l(),S(Mn,{key:1,ref_key:"chatRecordsMainRef",ref:n,userData:d.value,setScrollTop:s,updateScrollTop:c},null,8,["userData"]))]),_:1},512)]),_:1})]),_:1})}}}),sl={class:"progress-bar"},Z=V({__name:"ProgressBar",props:{startORstop:{type:Number,required:!0}},setup(t){const i=m(0),n=m(500),a=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],s=m(new Date().getTime()),c=t,v=()=>{if(c.startORstop===1){i.value=100;return}s.value=new Date().getTime(),!(i.value>=99)&&(i.value>=80&&(n.value=n.value+50),i.value=i.value+1,setTimeout(v,n.value))};return v(),(p,d)=>{const b=w("el-progress");return l(),r("div",sl,[o(b,{type:"dashboard",percentage:i.value,color:a},null,8,["percentage"])])}}}),al={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},il={key:0},rl={key:0},cl={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},dl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),ul={style:{"margin-top":"20px"}},_l={style:{"margin-top":"20px"}},pl={key:1},hl={key:0},vl={key:1,style:{"background-color":"#fff",width:"80%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},fl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),ml={style:{"margin-top":"20px"}},yl={key:0},xl=e("br",null,null,-1),wl=e("br",null,null,-1),gl={key:1},bl=e("br",null,null,-1),$l=e("br",null,null,-1),kl={key:2},Ul=e("label",null,"密钥key(必填): ",-1),Sl=e("br",null,null,-1),Vl={key:3},Ml=e("label",null,"merge_all.db 文件路径(必填,非文件夹): ",-1),El=e("br",null,null,-1),Cl=e("label",null,"微信文件夹路径(必填): ",-1),Tl=e("br",null,null,-1),Dl=e("label",null,"微信原始id(必填): ",-1),ql=e("br",null,null,-1),zl={key:2},Rl={key:3,style:{display:"flex","justify-content":"space-between"}},jl={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},Il=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"使用上次设置")],-1),Ll={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},Ol=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),Hl={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},Nl=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),Bl=V({__name:"IsAutoShow",emits:["isAutoShow"],setup(t,{emit:i}){const n=m(0),a=m(-1),s=m(""),c=m(!1),v=m([]),p=m(""),d=m(!1),b=m(!1),u=m("false"),$=m(""),T=m(""),x=m(""),D=m(""),I=i,j=async()=>{try{v.value=await C.post("/api/wxinfo"),v.value.length===1&&(R(v.value[0]),p.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(y,5e3))}catch(U){return console.error("Error fetching data:",U),[]}},R=async U=>{$.value="",T.value=U.filePath,x.value=U.key,D.value=U.wxid},y=()=>{if(T.value===""&&x.value===""&&D.value===""){console.log("请填写完整信息! ");return}if(d.value){console.log("正在解密...，请稍后再试！");return}q()},q=async()=>{if(d.value){console.log("正在解密中，请稍后再试！");return}d.value=!0;try{d.value=!0,a.value=0;let U={wx_path:T.value,key:x.value,my_wxid:D.value};const k=await C.post("/api/init_key",U);c.value=k.is_init,k.is_init&&(n.value=100),d.value=!1,I("isAutoShow",k.is_init)}catch(U){return n.value=0,b.value=!0,d.value=!1,K.alert(U,"error",{confirmButtonText:"确认",callback:k=>{ae({type:"error",message:`action: ${k}`})}}),[]}d.value=!1},E=async()=>{try{let U={wx_path:T.value,merge_path:$.value,my_wxid:D.value};const k=await C.post("/api/init_nokey",U);c.value=k.is_init,k.is_init&&(n.value=100),d.value=!1,I("isAutoShow",k.is_init)}catch(U){return n.value=0,b.value=!0,d.value=!1,K.alert(U,"error",{confirmButtonText:"确认",callback:k=>{s.value=""}}),[]}d.value=!1},_=async()=>{try{let U={wx_path:T.value,merge_path:$.value,my_wxid:D.value};const k=await C.post("/api/init_last",U);c.value=k.is_init,k.is_init?(n.value=100,d.value=!1,I("isAutoShow",k.is_init)):(b.value=!0,d.value=!1,K.alert("未发现上次的设置数据！","error",{confirmButtonText:"确认",callback:P=>{s.value=""}})),d.value=!1}catch(U){return b.value=!0,d.value=!1,K.alert(U,"error",{confirmButtonText:"确认",callback:k=>{s.value=""}}),[]}d.value=!1};return L(s,U=>{U==="auto"?j():U==="custom"||U==="last"&&_()}),(U,k)=>{const P=w("el-button"),te=w("el-divider"),W=w("el-input");return l(),r("div",al,[s.value==="auto"?(l(),r("div",il,[d.value?(l(),r("div",rl,[d.value?(l(),S(Z,{key:0,startORstop:a.value},null,8,["startORstop"])):M("",!0)])):(l(),r("div",cl,[dl,e("div",ul,[o(H(se),{data:v.value,onCurrentChange:R,"highlight-current-row":"",style:{width:"100%"}},{default:h(()=>[o(H(B),{"min-width":30,prop:"pid",label:"进程id"}),o(H(B),{"min-width":40,prop:"version",label:"微信版本"}),o(H(B),{"min-width":40,prop:"account",label:"账号"}),o(H(B),{"min-width":40,prop:"name",label:"昵称"}),o(H(B),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",_l,[o(P,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:y},{default:h(()=>[f("确定"+g(p.value),1)]),_:1})])]))])):s.value==="custom"?(l(),r("div",pl,[d.value?(l(),r("div",hl,[d.value?(l(),S(Z,{key:0,startORstop:a.value},null,8,["startORstop"])):M("",!0)])):(l(),r("div",vl,[fl,e("div",ml,[N(e("input",{type:"radio","onUpdate:modelValue":k[0]||(k[0]=z=>u.value=z),value:"true"},null,512),[[F,u.value]]),f(" 使用 KEY          "),N(e("input",{type:"radio","onUpdate:modelValue":k[1]||(k[1]=z=>u.value=z),value:"false"},null,512),[[F,u.value]]),f(" 不使用 KEY "),u.value=="false"?(l(),r("div",yl,[f(" 说明：1、表示数据库已解密并合并"),xl,f("2、合并后的数据库需要包含(MediaMSG,MSG,MicroMsg,OpenIMMsg)这些数据库合并的内容"),wl])):M("",!0),u.value=="true"?(l(),r("div",gl,[f(" 说明：1、自动根据key解密微信文件夹下的数据库"),bl,f("2、必须保证key正确，否则解密失败"),$l])):M("",!0),o(te),u.value=="true"?(l(),r("div",kl,[Ul,o(W,{placeholder:"密钥key (64位)",modelValue:x.value,"onUpdate:modelValue":k[2]||(k[2]=z=>x.value=z),style:{width:"80%"}},null,8,["modelValue"]),Sl])):M("",!0),u.value=="false"?(l(),r("div",Vl,[Ml,o(W,{placeholder:"(MediaMSG.db,MSG.db,MicroMsg.db,OpenIMMsg.db)合并后的数据库",modelValue:$.value,"onUpdate:modelValue":k[3]||(k[3]=z=>$.value=z),style:{width:"80%"}},null,8,["modelValue"]),El])):M("",!0),Cl,o(W,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:T.value,"onUpdate:modelValue":k[4]||(k[4]=z=>T.value=z),style:{width:"80%"}},null,8,["modelValue"]),Tl,Dl,o(W,{placeholder:"wxid_*******",modelValue:D.value,"onUpdate:modelValue":k[5]||(k[5]=z=>D.value=z),style:{width:"80%"}},null,8,["modelValue"]),ql,u.value=="true"?(l(),S(P,{key:4,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:q},{default:h(()=>[f(" 确定 ")]),_:1})):M("",!0),u.value=="false"?(l(),S(P,{key:5,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:E},{default:h(()=>[f(" 确定 ")]),_:1})):M("",!0)])]))])):s.value==="last"?(l(),r("div",zl)):s.value===""?(l(),r("div",Rl,[e("label",jl,[N(e("input",{type:"radio","onUpdate:modelValue":k[6]||(k[6]=z=>s.value=z),value:"last"},null,512),[[F,s.value]]),Il]),e("label",Ll,[N(e("input",{type:"radio","onUpdate:modelValue":k[7]||(k[7]=z=>s.value=z),value:"auto"},null,512),[[F,s.value]]),Ol]),e("label",Hl,[N(e("input",{type:"radio","onUpdate:modelValue":k[8]||(k[8]=z=>s.value=z),value:"custom"},null,512),[[F,s.value]]),Nl])])):M("",!0)])}}}),Fl={id:"chat_view",class:"common-layout"},Al={key:0},Pl={key:1},Wl={key:0,style:{height:"100vh",width:"100%"}},Kl={key:1,style:{width:"90%",height:"100%"}},Ql=V({__name:"ChatView",setup(t){const i=m(!1),n=c=>{i.value=c},a=m(""),s=c=>{a.value=c};return(c,v)=>{const p=w("el-aside"),d=w("el-container");return l(),r("div",Fl,[i.value?(l(),r("div",Pl,[o(d,{style:{height:"100vh","max-width":"100%"}},{default:h(()=>[o(p,{width:"auto",style:{"overflow-y":"auto",height:"100%"}},{default:h(()=>[o(he,{onWxid:s})]),_:1}),a.value!=""?(l(),r("div",Wl,[o(ol,{wxid:a.value},null,8,["wxid"])])):(l(),r("div",Kl,[o(ie)]))]),_:1})])):(l(),r("div",Al,[o(Bl,{onIsAutoShow:n})]))])}}});export{Ql as default};
